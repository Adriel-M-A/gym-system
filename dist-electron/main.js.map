{"version":3,"sources":["../main/main.ts","../main/database/migrator.ts","../main/database/connection.ts","../main/modules/users/users.repository.ts","../main/modules/users/users.ipc.ts","../main/modules/members/members.repository.ts","../main/modules/memberships/memberships.repository.ts","../main/utils/date.utils.ts","../main/modules/members/members.service.ts","../main/modules/members/members.ipc.ts","../main/modules/memberships/memberships.service.ts","../main/modules/memberships/memberships.ipc.ts"],"sourcesContent":["import { app, BrowserWindow, ipcMain } from 'electron';\r\nimport path from 'path';\r\nimport { runMigrations } from './database/migrator';\r\nimport usersModule from './modules/users/users.ipc';\r\nimport membersModule from './modules/members/members.ipc';\r\nimport membershipsModule from './modules/memberships/memberships.ipc';\r\n\r\n// Comentario: Función para crear la ventana principal de la aplicación.\r\nfunction createWindow() {\r\n    const mainWindow = new BrowserWindow({\r\n        width: 1200,\r\n        height: 800,\r\n        webPreferences: {\r\n            preload: path.join(__dirname, 'preload.js'),\r\n            nodeIntegration: false,\r\n            contextIsolation: true,\r\n        },\r\n    });\r\n\r\n    // Comentario: En desarrollo, carga la URL del servidor de Vite.\r\n    // En producción, carga el archivo HTML compilado.\r\n    const isDev = !app.isPackaged;\r\n\r\n    if (isDev) {\r\n        // En dev, Vite corre en 3000 (wait-on tcp:3000 en package.json)\r\n        mainWindow.loadURL('http://localhost:3000');\r\n        // Comentario: Abre las herramientas de desarrollo automáticamente en modo dev.\r\n        mainWindow.webContents.openDevTools();\r\n    } else {\r\n        mainWindow.loadFile(path.join(__dirname, '../dist/index.html'));\r\n    }\r\n}\r\n\r\n// Comentario: Se ejecuta cuando Electron ha terminado de inicializarse.\r\napp.whenReady().then(() => {\r\n    // Comentario: Inicializar base de datos y migraciones\r\n    runMigrations();\r\n\r\n    // Registrar módulos IPC antes de crear ventana\r\n    usersModule.registerIpc(ipcMain);\r\n    membersModule.registerIpc(ipcMain);\r\n    membershipsModule.registerIpc(ipcMain);\r\n\r\n    createWindow();\r\n\r\n    app.on('activate', () => {\r\n        // Comentario: En macOS, es común recrear la ventana si se hace clic en el dock.\r\n        if (BrowserWindow.getAllWindows().length === 0) {\r\n            createWindow();\r\n        }\r\n    });\r\n});\r\n\r\n// Comentario: Cierra la aplicación cuando todas las ventanas están cerradas (excepto en macOS).\r\napp.on('window-all-closed', () => {\r\n    if (process.platform !== 'darwin') {\r\n        app.quit();\r\n    }\r\n});\r\n","import fs from 'fs';\r\nimport path from 'path';\r\nimport db from './connection';\r\n\r\nexport function runMigrations(): void {\r\n    console.log('[Migrator] Starting migrations...');\r\n\r\n    // 1. Crear tabla de migraciones si no existe\r\n    db.prepare(`\r\n    CREATE TABLE IF NOT EXISTS _migrations (\r\n      id INTEGER PRIMARY KEY AUTOINCREMENT,\r\n      name TEXT NOT NULL UNIQUE,\r\n      applied_at DATETIME DEFAULT CURRENT_TIMESTAMP\r\n    )\r\n  `).run();\r\n\r\n    // 2. Leer archivos de migración\r\n    // IMPORTANTE: En producción con Vite/Electron, los archivos .sql deben ser copiados a dist\r\n    // o leídos de una manera compatible.\r\n    // Asumiremos que están en __dirname/migrations en dev y prod por ahora,\r\n    // pero esto podría requerir ajustes en vite.config.ts para copiar assets.\r\n    // En dev (ts-node/vite), __dirname puede ser distinto.\r\n    // Usaremos path.resolve para intentar ubicarlo relativo al archivo compilado.\r\n\r\n    const migrationsDir = path.join(__dirname, 'migrations');\r\n    console.log(`[Migrator] Searching for migrations in: ${migrationsDir}`);\r\n\r\n    if (!fs.existsSync(migrationsDir)) {\r\n        console.log(`[Migrator] No migrations folder found at ${migrationsDir}`);\r\n        return;\r\n    }\r\n\r\n    const files = fs.readdirSync(migrationsDir)\r\n        .filter((file) => file.endsWith('.sql'))\r\n        .sort();\r\n\r\n    console.log(`[Migrator] Found ${files.length} migration files:`, files);\r\n\r\n    // 3. Ejecutar migraciones pendientes\r\n    const appliedStmt = db.prepare('SELECT name FROM _migrations WHERE name = ?');\r\n    const insertStmt = db.prepare('INSERT INTO _migrations (name) VALUES (?)');\r\n\r\n    files.forEach((file) => {\r\n        const isApplied = appliedStmt.get(file);\r\n\r\n        if (!isApplied) {\r\n            console.log(`[Migrator] Applying ${file}...`);\r\n            const script = fs.readFileSync(path.join(migrationsDir, file), 'utf-8');\r\n\r\n            const transaction = db.transaction(() => {\r\n                db.exec(script);\r\n                insertStmt.run(file);\r\n            });\r\n\r\n            try {\r\n                transaction();\r\n                console.log(`[Migrator] ${file} applied successfully.`);\r\n            } catch (err) {\r\n                console.error(`[Migrator] Error applying ${file}:`, err);\r\n                throw err;\r\n            }\r\n        }\r\n    });\r\n\r\n    console.log('[Migrator] All migrations checked.');\r\n}\r\n","import Database from 'better-sqlite3';\r\nimport path from 'path';\r\nimport { app } from 'electron';\r\n\r\nconst isDev = !app.isPackaged;\r\n\r\n// En desarrollo, guardamos la DB en la raíz del proyecto.\r\n// En producción, en la carpeta de datos de usuario del SO.\r\nconst dbPath = isDev\r\n    ? path.join(process.cwd(), 'database.db')\r\n    : path.join(app.getPath('userData'), 'database.db');\r\n\r\nconst db = new Database(dbPath, { verbose: console.log });\r\ndb.pragma('journal_mode = WAL');\r\n\r\nexport default db;\r\n","import db from '../../database/connection';\r\nimport { User } from '../../../shared/types/db-models';\r\nimport { RunResult } from 'better-sqlite3';\r\n\r\nfunction getAllUsers(): User[] {\r\n    const stmt = db.prepare('SELECT * FROM users ORDER BY created_at DESC');\r\n    return stmt.all() as User[];\r\n}\r\n\r\nfunction createUser(name: string, email: string): User {\r\n    const stmt = db.prepare('INSERT INTO users (name, email) VALUES (?, ?)');\r\n    const info: RunResult = stmt.run(name, email);\r\n\r\n    // Devolvemos el objeto User parcial o completamos con valores por defecto/query\r\n    // Para simplificar, asumimos que se creó bien.\r\n    return {\r\n        id: Number(info.lastInsertRowid),\r\n        name,\r\n        email,\r\n        created_at: new Date().toISOString() // Aproximación, idealmente obtener de BD\r\n    };\r\n}\r\n\r\nexport default {\r\n    getAllUsers,\r\n    createUser\r\n};\r\n","import { IpcMain } from 'electron';\r\nimport usersRepository from './users.repository';\r\n\r\nfunction registerIpc(ipcMain: IpcMain) {\r\n    ipcMain.handle('db:get-users', async () => {\r\n        return usersRepository.getAllUsers();\r\n    });\r\n\r\n    ipcMain.handle('db:create-user', async (_, user) => {\r\n        return usersRepository.createUser(user.name, user.email);\r\n    });\r\n}\r\n\r\nexport default { registerIpc };\r\n","import db from '../../database/connection';\r\nimport { Member, MemberWithActiveMembership } from '../../../shared/types/db-models';\r\nimport { RunResult } from 'better-sqlite3';\r\n\r\n// --- Members CRUD ---\r\n\r\nfunction createMember(data: Partial<Member>): Member {\r\n    const stmt = db.prepare(`\r\n        INSERT INTO members (first_name, last_name, dni, phone, email, birth_date, notes)\r\n        VALUES (@first_name, @last_name, @dni, @phone, @email, @birth_date, @notes)\r\n    `);\r\n\r\n    // Asegurar mapeo de camelCase a snake_case si es necesario, \r\n    // pero aquí el objeto 'data' debería venir ya formateado o usamos parámetros nombrados\r\n    // que coincidan con las claves del objeto.\r\n    // El frontend suele enviar camelCase, revisaremos el servicio para la conversión si hace falta.\r\n    // Asumiremos que el servicio pasa los datos listos o las claves coinciden con los @params.\r\n    // Revisando members.repository.js original: VALUES (@firstName...)\r\n    // Entonces el objeto debe tener claves firstName, lastName.\r\n    // Ajustaremos para usar las claves correctas.\r\n\r\n    // En el JS original: VALUES (@firstName, @lastName...)\r\n    // Entonces `data` tiene { firstName, lastName ... }\r\n\r\n    const info: RunResult = stmt.run(data);\r\n    return { id: Number(info.lastInsertRowid), ...data } as Member;\r\n}\r\n\r\nfunction updateMember(id: number, data: Partial<Member>): Member | undefined {\r\n    // El original usaba @firstName etc.\r\n    const stmt = db.prepare(`\r\n        UPDATE members \r\n        SET first_name = @first_name, last_name = @last_name, dni = @dni, \r\n            phone = @phone, email = @email, birth_date = @birth_date, notes = @notes\r\n        WHERE id = @id\r\n    `);\r\n    stmt.run({ ...data, id });\r\n    return getMemberById(id);\r\n}\r\n\r\nfunction setMemberStatus(id: number, isActive: boolean) {\r\n    const stmt = db.prepare('UPDATE members SET is_active = ? WHERE id = ?');\r\n    stmt.run(isActive ? 1 : 0, id);\r\n    return { id, is_active: isActive };\r\n}\r\n\r\nfunction getMemberById(id: number): Member | undefined {\r\n    return db.prepare('SELECT * FROM members WHERE id = ?').get(id) as Member;\r\n}\r\n\r\nfunction getMemberByDni(dni: string): Member | undefined {\r\n    return db.prepare('SELECT * FROM members WHERE dni = ?').get(dni) as Member;\r\n}\r\n\r\nfunction getMembers(params: { search?: string; onlyActive?: boolean } = {}): MemberWithActiveMembership[] {\r\n    const { search, onlyActive = true } = params;\r\n    let sql = `\r\n        SELECT m.*, \r\n               mm.name as membership_name, \r\n               mem_sub.status as membership_status,\r\n               mem_sub.end_date as membership_end_date\r\n        FROM members m\r\n        LEFT JOIN (\r\n            SELECT member_id, membership_id, status, end_date\r\n            FROM member_memberships\r\n            WHERE status = 'ACTIVE' AND end_date >= DATE('now', 'localtime')\r\n            GROUP BY member_id\r\n        ) mem_sub ON m.id = mem_sub.member_id\r\n        LEFT JOIN memberships mm ON mem_sub.membership_id = mm.id\r\n        WHERE 1=1\r\n    `;\r\n\r\n    const args: any[] = [];\r\n\r\n    if (onlyActive) {\r\n        sql += ' AND m.is_active = 1';\r\n    }\r\n\r\n    if (search) {\r\n        sql += ' AND (m.first_name LIKE ? OR m.last_name LIKE ? OR m.dni LIKE ?)';\r\n        const likeTerm = `%${search}%`;\r\n        args.push(likeTerm, likeTerm, likeTerm);\r\n    }\r\n\r\n    sql += ' ORDER BY m.last_name, m.first_name';\r\n\r\n    const rows = db.prepare(sql).all(...args) as any[];\r\n\r\n    // Mappear a estructura MemberWithActiveMembership\r\n    return rows.map(row => {\r\n        const { membership_name, membership_status, membership_end_date, ...memberData } = row;\r\n        const member: MemberWithActiveMembership = { ...memberData };\r\n\r\n        if (membership_name) {\r\n            member.active_membership = {\r\n                id: 0, // No recuperamos el ID de la tabla intemedia en el SELECT principal de arriba por defecto, revisar si es crítico\r\n                member_id: member.id,\r\n                membership_id: 0, // Tampoco\r\n                status: membership_status,\r\n                start_date: '', // No recuperado\r\n                end_date: membership_end_date,\r\n                price_at_purchase: 0,\r\n                created_at: '',\r\n                name: membership_name\r\n            };\r\n        }\r\n        return member;\r\n    });\r\n}\r\n\r\n// --- Member Memberships (Subscriptions) ---\r\n\r\nfunction assignMembership(data: any) {\r\n    const stmt = db.prepare(`\r\n        INSERT INTO member_memberships (member_id, membership_id, start_date, end_date, price_at_purchase)\r\n        VALUES (@memberId, @membershipId, @startDate, @endDate, @price)\r\n    `);\r\n    const info: RunResult = stmt.run(data);\r\n    return { id: Number(info.lastInsertRowid), ...data };\r\n}\r\n\r\nfunction getActiveMembership(memberId: number) {\r\n    return db.prepare(`\r\n        SELECT mm.*, m.name as membership_name \r\n        FROM member_memberships mm\r\n        JOIN memberships m ON mm.membership_id = m.id\r\n        WHERE mm.member_id = ? \r\n        AND mm.end_date >= DATE('now', 'localtime')\r\n        AND mm.status = 'ACTIVE'\r\n        ORDER BY mm.end_date DESC\r\n        LIMIT 1\r\n    `).get(memberId);\r\n}\r\n\r\nfunction getMembersWithExpiredMemberships() {\r\n    return db.prepare(`\r\n        SELECT m.*, mm.end_date as expiration_date\r\n        FROM members m\r\n        JOIN member_memberships mm ON m.id = mm.member_id\r\n        WHERE mm.status = 'ACTIVE' AND mm.end_date < DATE('now', 'localtime')\r\n    `).all();\r\n}\r\n\r\nexport default {\r\n    createMember,\r\n    updateMember,\r\n    setMemberStatus,\r\n    getMemberById,\r\n    getMemberByDni,\r\n    getMembers,\r\n    assignMembership,\r\n    getActiveMembership,\r\n    getMembersWithExpiredMemberships\r\n};\r\n","import db from '../../database/connection';\r\nimport { Membership } from '../../../shared/types/db-models';\r\nimport { RunResult } from 'better-sqlite3';\r\n\r\nfunction createMembership(data: Partial<Membership>): Membership {\r\n    const stmt = db.prepare(`\r\n        INSERT INTO memberships (name, price, duration_days, description)\r\n        VALUES (@name, @price, @duration_days, @description)\r\n    `);\r\n    // Ojo: @durationDays vs @duration_days. En DB original schema (002) es duration_days.\r\n    // El repo original usaba @durationDays, asumo que mandaban el objeto con camelCase.\r\n    // Pero aquí 'data' parcial de Membership tiene snake_case si usamos la interfaz DB.\r\n    // Si viene del frontend/service, suele ser camelCase.\r\n    // Estandaricemos a que data aquí debe coincidir con los parámetros SQL.\r\n    // Voy a cambiar SQL parámetros para usar camelCase para facilitar el paso directo de objetos JS,\r\n    // o mapear. Mejor mapear keys si es necesario, pero SQLite bind @param busca la key param.\r\n    // Usaremos camelCase en el query para coincidir con lo que probablemente envíe el servicio (que recibe del IPC).\r\n    // Aunque... Membership interface tiene duration_days.\r\n    // Si usamos data: Partial<Membership> (interface DB), entonces data.duration_days.\r\n    // Entonces SQL params deben ser @duration_days.\r\n\r\n    // Revisión rápida members.repository.js original:\r\n    // INSERT INTO memberships ... VALUES (@name, @price, @durationDays, @description)\r\n    // Esto implica que el objeto data tenía { durationDays: ... }\r\n\r\n    // Si queremos ser estrictos con TypeScript, definiremos una interfaz de entrada (Dto).\r\n    // Por ahora, modifico el SQL para esperar duration_days si usamos la interfaz DB.\r\n\r\n    // Pero si el frontend manda camelCase...\r\n    // El servicio debería normalizar o el repo.\r\n    // Asumiré que el repo recibe data con formato DB (snake_case) para ser consistente con el tipo Membership.\r\n    // Así que usaré @duration_days.\r\n\r\n    const stmtFix = db.prepare(`\r\n        INSERT INTO memberships (name, price, duration_days, description)\r\n        VALUES (@name, @price, @duration_days, @description)\r\n    `);\r\n\r\n    const info: RunResult = stmtFix.run(data);\r\n    return { id: Number(info.lastInsertRowid), ...data } as Membership;\r\n}\r\n\r\nfunction updateMembership(id: number, data: Partial<Membership>) {\r\n    const stmt = db.prepare(`\r\n        UPDATE memberships\r\n        SET name = @name, price = @price, duration_days = @duration_days, description = @description\r\n        WHERE id = @id\r\n    `);\r\n    stmt.run({ ...data, id });\r\n    return getMembershipById(id);\r\n}\r\n\r\nfunction getMembershipById(id: number): Membership | undefined {\r\n    return db.prepare('SELECT * FROM memberships WHERE id = ?').get(id) as Membership;\r\n}\r\n\r\nfunction getAllMemberships(onlyActive = true): Membership[] {\r\n    let sql = 'SELECT * FROM memberships';\r\n    if (onlyActive) {\r\n        sql += ' WHERE is_active = 1';\r\n    }\r\n    return db.prepare(sql).all() as Membership[];\r\n}\r\n\r\nfunction deleteMembership(id: number) {\r\n    // Soft delete\r\n    return db.prepare('UPDATE memberships SET is_active = 0 WHERE id = ?').run(id);\r\n}\r\n\r\nexport default {\r\n    createMembership,\r\n    updateMembership,\r\n    getMembershipById,\r\n    getAllMemberships,\r\n    deleteMembership\r\n};\r\n","/**\r\n * Retorna la fecha actual o dada en formato YYYY-MM-DD usando la zona horaria LOCAL.\r\n */\r\nexport function toLocalDate(date: Date = new Date()): string {\r\n    const year = date.getFullYear();\r\n    const month = String(date.getMonth() + 1).padStart(2, '0');\r\n    const day = String(date.getDate()).padStart(2, '0');\r\n    return `${year}-${month}-${day}`;\r\n}\r\n\r\n/**\r\n * Retorna la fecha y hora actual o dada en formato YYYY-MM-DD HH:MM:SS usando la zona horaria LOCAL.\r\n */\r\nexport function toLocalDateTime(date: Date = new Date()): string {\r\n    const d = toLocalDate(date);\r\n    const hours = String(date.getHours()).padStart(2, '0');\r\n    const minutes = String(date.getMinutes()).padStart(2, '0');\r\n    const seconds = String(date.getSeconds()).padStart(2, '0');\r\n    return `${d} ${hours}:${minutes}:${seconds}`;\r\n}\r\n\r\n/**\r\n * Agrega días a una fecha dada, respetando la zona local.\r\n */\r\nexport function addDays(date: Date, days: number): Date {\r\n    const result = new Date(date);\r\n    result.setDate(result.getDate() + days);\r\n    return result;\r\n}\r\n\r\nexport default {\r\n    toLocalDate,\r\n    toLocalDateTime,\r\n    addDays\r\n};\r\n","import membersRepo from './members.repository';\r\nimport membershipsRepo from '../memberships/memberships.repository';\r\n// Importamos dateUtils. Si no está migrado, usaremos require o asumiremos existe.\r\n// Asumiremos que lo migraremos a .ts también.\r\nimport dateUtils from '../../utils/date.utils';\r\nimport { Member, MemberWithActiveMembership } from '../../../shared/types/db-models';\r\n\r\nclass MembersService {\r\n\r\n    createMember(data: Partial<Member>) {\r\n        // Validar duplicado por DNI\r\n        if (data.dni) {\r\n            const existing = membersRepo.getMemberByDni(data.dni);\r\n            if (existing) {\r\n                throw new Error(`Ya existe un socio con DNI ${data.dni}`);\r\n            }\r\n        }\r\n        return membersRepo.createMember(data);\r\n    }\r\n\r\n    updateMember(id: number, data: Partial<Member>) {\r\n        if (data.dni) {\r\n            const existing = membersRepo.getMemberByDni(data.dni);\r\n            if (existing && existing.id !== id) {\r\n                throw new Error(`El DNI ${data.dni} ya pertenece a otro socio`);\r\n            }\r\n        }\r\n        return membersRepo.updateMember(id, data);\r\n    }\r\n\r\n    toggleActiveStatus(id: number) {\r\n        const member = membersRepo.getMemberById(id);\r\n        if (!member) throw new Error('Socio no encontrado');\r\n        // member.is_active puede ser 0 o 1, al negar !member.is_active funciona igual\r\n        return membersRepo.setMemberStatus(id, !member.is_active);\r\n    }\r\n\r\n    getAllMembers(params: { search?: string, onlyActive?: boolean } = {}) {\r\n        // params: { search, onlyActive }\r\n        const members = membersRepo.getMembers(params);\r\n\r\n        // El repositorio ya devuelve MemberWithActiveMembership casi listo,\r\n        // pero la lógica original hacía un mapeo manual.\r\n        // En members.repository.ts ya hicimos el mapeo.\r\n        // Si membersRepo.getMembers devuelve la estructura correcta, devolvemos directo.\r\n        // Sin embargo, el repo devuelve active_membership populado.\r\n\r\n        return members;\r\n    }\r\n\r\n    getMemberDetail(id: number) {\r\n        const member = membersRepo.getMemberById(id) as MemberWithActiveMembership;\r\n        if (!member) throw new Error('Socio no encontrado');\r\n\r\n        const activeMembership = membersRepo.getActiveMembership(id);\r\n        if (activeMembership) {\r\n            member.active_membership = {\r\n                ...activeMembership,\r\n                status: activeMembership.status as 'ACTIVE' | 'EXPIRED' | 'CANCELLED'\r\n            } as any;\r\n        }\r\n        return member;\r\n    }\r\n\r\n    assignMembership(memberId: number, membershipId: number) {\r\n        const membership = membershipsRepo.getMembershipById(membershipId);\r\n        if (!membership) throw new Error('Membresía no encontrada');\r\n\r\n        const startDate = new Date();\r\n        const endDate = dateUtils.addDays(startDate, membership.duration_days);\r\n\r\n        const assignmentData = {\r\n            memberId,\r\n            membershipId,\r\n            startDate: dateUtils.toLocalDate(startDate),\r\n            endDate: dateUtils.toLocalDate(endDate),\r\n            price: membership.price\r\n        };\r\n\r\n        return membersRepo.assignMembership(assignmentData);\r\n    }\r\n\r\n    getExpiredMembers() {\r\n        return membersRepo.getMembersWithExpiredMemberships();\r\n    }\r\n}\r\n\r\nexport default new MembersService();\r\n","import { IpcMain } from 'electron';\r\nimport membersService from './members.service';\r\n\r\nfunction registerIpc(ipcMain: IpcMain) {\r\n    // --- Members ---\r\n    ipcMain.handle('members:create', async (_, data) => {\r\n        return membersService.createMember(data);\r\n    });\r\n\r\n    ipcMain.handle('members:update', async (_, { id, data }) => {\r\n        return membersService.updateMember(id, data);\r\n    });\r\n\r\n    ipcMain.handle('members:get-all', async (_, params = {}) => {\r\n        return membersService.getAllMembers(params);\r\n    });\r\n\r\n    ipcMain.handle('members:get-by-id', async (_, id) => {\r\n        return membersService.getMemberDetail(id);\r\n    });\r\n\r\n    ipcMain.handle('members:toggle-status', async (_, id) => {\r\n        return membersService.toggleActiveStatus(id);\r\n    });\r\n\r\n    // --- Subscriptions ---\r\n    ipcMain.handle('members:assign-membership', async (_, { memberId, membershipId }) => {\r\n        return membersService.assignMembership(memberId, membershipId);\r\n    });\r\n\r\n    ipcMain.handle('members:get-expired', async () => {\r\n        return membersService.getExpiredMembers();\r\n    });\r\n}\r\n\r\nexport default { registerIpc };\r\n","import membershipsRepo from './memberships.repository';\r\nimport { Membership } from '../../../shared/types/db-models';\r\n\r\nclass MembershipsService {\r\n    createMembership(data: Partial<Membership>) {\r\n        return membershipsRepo.createMembership(data);\r\n    }\r\n\r\n    getAllMemberships(onlyActive: boolean) {\r\n        return membershipsRepo.getAllMemberships(onlyActive);\r\n    }\r\n\r\n    updateMembership(id: number, data: Partial<Membership>) {\r\n        if (!membershipsRepo.getMembershipById(id)) {\r\n            throw new Error('Membresía no encontrada');\r\n        }\r\n        return membershipsRepo.updateMembership(id, data);\r\n    }\r\n\r\n    deleteMembership(id: number) {\r\n        return membershipsRepo.deleteMembership(id);\r\n    }\r\n}\r\n\r\nexport default new MembershipsService();\r\n","import { IpcMain } from 'electron';\r\nimport membershipsService from './memberships.service';\r\n\r\nfunction registerIpc(ipcMain: IpcMain) {\r\n    ipcMain.handle('memberships:create', async (_, data) => {\r\n        return membershipsService.createMembership(data);\r\n    });\r\n\r\n    ipcMain.handle('memberships:update', async (_, { id, data }) => {\r\n        return membershipsService.updateMembership(id, data);\r\n    });\r\n\r\n    ipcMain.handle('memberships:get-all', async (_, { onlyActive } = {}) => {\r\n        return membershipsService.getAllMemberships(onlyActive);\r\n    });\r\n\r\n    ipcMain.handle('memberships:delete', async (_, id) => {\r\n        return membershipsService.deleteMembership(id);\r\n    });\r\n}\r\n\r\nexport default { registerIpc };\r\n"],"mappings":"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","names":["import_electron","import_path","import_path","path","Database","path","fs","ipcMain","registerIpc","ipcMain","registerIpc","ipcMain","path","isDev"]}